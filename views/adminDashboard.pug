extends layout

block content
  h1 Admin Dashboard
  if error
    div.error-message= error
  if !currentUser || !currentUser.isAdmin
    div.error-message Access Denied
  else
    div.admin-controls
      button#refreshData.button Refresh Data
    table.table
      thead
        tr
          th Username
          th Token
          th Last Update
      tbody#userTable
        each user in users
          tr(data-userid=user._id)
            td= user.username
            td= user.token
            td= user.lastTokenUpdate ? user.lastTokenUpdate.toLocaleString() : 'Never'

    script.
      let isLoading = false;

      async function refreshData() {
        if (isLoading) return;
        isLoading = true;
        try {
          const response = await fetch('/api/admin/users');
          const users = await response.json();
          updateTable(users);
        } catch (err) {
          showError('Failed to refresh data');
        } finally {
          isLoading = false;
        }
      }

      document.getElementById('refreshData')
        .addEventListener('click', refreshData);

      setInterval(refreshData, 15000);